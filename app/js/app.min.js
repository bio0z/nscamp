Vue.component("modal",{template:"#modal-template"}),Vue.directive("phone",{bind(e){e.oninput=function(t){if(!t.isTrusted)return;let s=this.value.replace(/\D/g,"").match(/(\d{0,1})(\d{0,3})(\d{0,3})(\d{0,2})(\d{0,2})/);this.value=s[1]+" ("+s[2]+") "+s[3]+" "+s[4]+" "+s[5],e.dispatchEvent(new Event("input"))}},touch(e){}});let router=new VueRouter({mode:"history",routes:[]});Vue.config.devtools=!1;const{CalendarPanel:CalendarPanel}=DatePicker;function isValidDate(e){return e instanceof Date&&!isNaN(e)}let vm=new Vue({router:router,el:"#orderForm",components:{DatePicker:DatePicker,CalendarPanel:CalendarPanel},data:{domain:document.domain,locales:{ru:"RU",en:"EN"},phpPath:"",selectedLocale:"ru",days:[1,2,3,4,5,6,7,8,9],minDays:8,firstDay:new Date(2022,3,1),dateClearable:!1,innerValue:[new Date("2022-04-01"),new Date("2022-04-10")],promocode:null,activePass:null,passDetails:null,gallery:null,hotelGallery:null,roomGallery:null,form:{event:2,passColor:"#777fa8",pasCurrent:null,dateRange:[new Date("2022-04-01"),new Date("2022-04-10")],dateFrom:"2022-04-01",dateTill:"2022-04-10",tourDays:9,adults:2,adultsText:null,kids:null,kidsText:null,hotel:null,hotelName:null,hotelCurrent:null,hotelBreakfast:null,hotelBreakfastText:null,hotelBreakfastPrice:null,hotelPrice:null,address:null,room:null,roomName:null,roomCurrent:null,bed:null,bedId:null,fname:null,sname:null,email:null,phone:null,guest:null,guests:null,gfname:null,gsname:null,gphone:null,gemail:null,g3sname:null,g3fname:null,g4fname:null,g4sname:null,g5fname:null,g5sname:null,g6sname:null,g6fname:null,promocode:null,consent:null,offer:null,tourName:null,tourNumber:null,tourID:null,skipassPrice:0,tourPrice:0,arrTourDays:null,payed:null,passDiscount:1},translations:{title:{ru:"Купить тур",en:"Tour Booking"},titleP:{ru:"Купить Festival Pass",en:"Tour Pass"},step1:{ru:"Выберите тур",en:"Choose your tour"},roomType:{ru:"Тип номера",en:"Type of room"},bedType:{ru:"Тип кровати",en:"Type of bed"},hotelType:{ru:"Отель",en:"Hotel"},hotelBreakfast:{ru:"Завтраки",en:"Breakfast"},hotelBreakfastIncluded:{ru:"Завтрак включен",en:"Breakfast included"},hotelBreakfastNotIncluded:{ru:"Проживание без завтрака",en:"Breakfast not included"},passDetails:{ru:"Подробнее",en:"More"},soldOut:{ru:"SOLD OUT",en:"SOLD OUT"},stepNext:{ru:"Далее",en:"Next"},tourPriceText:{ru:"cтоимость: ",en:"сost: "},stepPrevious:{ru:"Назад",en:"Back"},firstGuest:{ru:"Первый гость",en:"First guest"},secondGuest:{ru:"Второй гость",en:"Second guest"},thirdGuest:{ru:"Третий гость",en:"Third guest"},fourthGuest:{ru:"Четвертый гость",en:"Fourth guest"},fifthGuest:{ru:"Пятый гость",en:"Fourth guest"},sixGuest:{ru:"Шестой гость",en:"Six guest"},guestName:{ru:"Имя",en:"Name"},guestsName:{ru:"Гости",en:"Guests"},guestsMail:{ru:"гостя",en:"guests"},guestMail:{ru:"гость",en:"guest"},guestssMail:{ru:"гостей",en:"guest"},hotelMailBreakfast:{ru:"с завтраком",en:"with breakfast"},hotelMailNoBreakfast:{ru:"без завтрака",en:"no breakfast"},guestSurname:{ru:"Фамилия",en:"Surname"},guestPhone:{ru:"Телефон",en:"Phone num"},guestHotel:{ru:"Отель",en:"Hotel"},guestPromoCode:{ru:"Промокод",en:"Promocode"},guestPromoCodeApply:{ru:"Применить",en:"Apply"},guestPromoCodeDiscount:{ru:"Скидка использована",en:"Promocode used"},userAgreement:{ru:"пользовательское соглашение",en:"user agreement"},newStarFAQ:{ru:"Часто задаваемые вопросы и ответы",en:"FAQ"},step3:{ru:"Выберите тип номера",en:"Choose room type"},step4:{ru:"Давайте знакомиться",en:"Lets get to know each other"},step5:{ru:"Дабл-чек",en:"Double check your details, please :)"},dateFrom:{ru:"Дата заезда",en:"Date in"},dateTill:{ru:"Дата выезда",en:"Date out"},dateNote:{ru:"* Туры длительностью менее 9 дней станут доступны с 01.01.2021",en:"* Туры длительностью менее 9 дней станут доступны с 01.01.2021"},tourAdults:{ru:"Количество взрослых",en:"Number of adults"},tourKids:{ru:"Количество детей",en:"Number of children"},step2:{ru:"Выберите отель",en:"Please, choose your accommodation"},stepGuests:{ru:"Количество гостей",en:"Number of guests"},errorChoosePass:{ru:"Вы забыли выбрать категорию",en:"Please, choose your pass"},errorChooseDates:{ru:"Вы забыли выбрать даты заезда",en:"Please, choose your the dates of tour"},errorChooseAdults:{ru:"Вы забыли выбрать количество человек",en:"Please, choose number of people"},errorChooseRoom:{ru:"Вы забыли выбрать вариант размещения",en:"Please, choose your accommodation."},errorFillFIO:{ru:"Вы забыли заполнить персональные данные",en:"Please, fill Name and Surname."},errorFillFIO2:{ru:"Вы забыли заполнить персональные данные второго гостя",en:"Please, fill Name and Surname."},errorFillFIO3:{ru:"Вы забыли заполнить персональные данные третьего гостя",en:"Please, fill Name and Surname."},errorFillFIO4:{ru:"Вы забыли заполнить персональные данные четвертого гостя",en:"Please, fill Name and Surname."},errorFillFIO5:{ru:"Вы забыли заполнить персональные данные пятого гостя",en:"Please, fill Name and Surname."},errorFillFIO6:{ru:"Вы забыли заполнить персональные данные шестого гостя",en:"Please, fill Name and Surname."},errorFillEmail:{ru:"Укажите электронную почту",en:"Please, fill Email"},errorFillCorrectEmail:{ru:"Укажите корректный адрес электронной почты",en:"Please, fill correct Email"},errorFillPhone:{ru:"Укажите Телефон",en:"Please, fill number of cell phone"},errorFillCorrectPhone:{ru:"Укажите корректный телефон",en:"Please, fill correct number of cell phone"},tourIncludedP:{ru:"<p><b>В тур включено:</b></p></li><ul></li><li> Браслет участника</li></li></ul>",en:"<p><b>Tour details:</b></p></li><ul></li><li> Festival PASS</li></li></ul>"},tourIncluded:{ru:"<p><b>В тур включено:</b></p></li><ul></li><li> Браслет участника</li></li><li> Проживание в отеле</li></li></ul>",en:"<p><b>Tour details:</b></p></li><ul></li><li> Festival PASS</li></li><li> Hotel accommodation</li></li><li> Cable lifts ticket(s)</li></li></ul>"},guestAgreement:{ru:"Я даю ",en:"I accept "},guestAgreement1:{ru:"согласие ",en:"Terms and Conditions"},guestAgreement2:{ru:"на обработку персональных данных",en:"."},guestOfferAccept:{ru:"Я согласен c ",en:"I accept "},guestOfferAccept1:{ru:"политикой конфиденциальности",en:"offer."},buyTour:{ru:"Купить тур",en:"Buy tour"},tourSuccess:{ru:"<p>Вы успешно оформили тур New Star Camp.</p></li><p>Ваучер отправлен на email.</p></li><p>Скоро увидимся ;)</p></li>",en:"<p>You win! :)</p><p>Voucher goes to email right now.</p></li><p>See you soon ;)</p></li>"},tourFail:{ru:'<p>Возникла ошибка при проведении платежа,</li><a href="#">попробуйте еще раз</a>.</p>',en:'<p>An error occurred while making a payment, </li><a href="#">try again</a>.</p>'},newStarDesc:{ru:"ООО «Нью Стар» — организатор спортивно-музыкального фестиваля New Star Camp,</li>который пройдёт 1 - 3 октября 2021 года на всесезонном горном курорте «Роза Хутор» (Сочи)",en:"“New Star” LLC is the organizer of “New Star Camp” sports and music festival, that will</li> be held on March 1 - 3 October, 2021 at Russian ski resort “Rosa Khutor” (Sochi)."}},sent:!1,showModal:!1,showOffer:!1,step:1,totalsteps:5,errors:null,guests:1,error:null,steps:[{active:!0,id:1,name:{ru:"Выбор<br> категории",en:"Choose<br> your tour"},text:"text-left",col:"col",desc:"До путешествия на Quiksilver New Star Camp 2022 осталось несколько шагов. Здесь ты можешь подобрать тур и узнать, что именно в него входит. Выбери один из вариантов, чтобы начать."},{active:!1,id:2,name:{ru:"Выбор<br> отеля",en:"Choose<br> dates"},text:"text-center",col:"col-3",desc:"Любой из отелей курорта «Роза Хутор» гарантирует удобную логистику до площадок фестиваля и сэкономит твоё время, чтобы ты всё успел."},{active:!1,id:3,name:{ru:"Выбор<br> номера",en:"Choose<br> room"},text:"text-center",col:"col-3",desc:"Во всех отелях курорта есть номера на любой вкус и кошелек. Просто выбери подходящий номер.<br> Рекомендуем добавить завтрак, чтобы начать день в горах полным энергии!"},{active:!1,id:4,name:{ru:"Персональные<br> данные",en:"Personal<br> details"},text:"text-center",col:"col-3",desc:"Мы рекомендуем покупать тур на все 10 дней фестиваля, ведь его программа очень насыщенная!"},{active:!1,id:5,name:{ru:"Покупка<br> тура",en:"Tour<br> purchasing"},text:"text-right",col:"col",desc:"Проверьте введенные данные, подтвердите согласие на их обработку и нажмите кнопку «Купить тур»"}],passSDetails:!1,passVDetails:!1,passPDetails:!1,passes:null,hotelQuota:"",freeHotels:[],hotelRooms:null,hotelRoomBeds:null,hotels:[]},methods:{activePasses(){if(this.passes)return this.passes.filter(e=>1===e.is_hotel)},activeHotels(){if(this.passes&&this.form.adults&&this.form.dateFrom&&this.form.dateTill)return this.hotels.filter(e=>e.maxGuests>=this.form.adults)},datesCampRange(e){const t=this.firstDay;return t.setHours(0,0,0,0),e<t||e>new Date(t.getTime()+7776e5)},getClasses:(e,t,s)=>!/disabled|active|not-current-month/.test(s)&&2===t.length&&e.getTime()>t[0].getTime()&&e.getTime()<t[1].getTime()?"in-range":"",handleSelect(e){const[t,s]=this.innerValue;isValidDate(t)&&!isValidDate(s)?(t.getTime()>e.getTime()?this.innerValue=[e,t]:this.innerValue=[t,e],this.form.dateRange=this.innerValue):this.innerValue=[e,new Date(NaN)]},setLocale:function(e){this.selectedLocale=e},validEmail:function(e){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)},validPhone:function(e){return!0},scrollToTop(){let e=document.getElementById("orderForm");window.scrollTo(0,e.offsetTop)},calcTourDays(){let e=0;this.form.dateRange=this.innerValue,this.form.dateFrom=this.form.dateRange[0],this.form.dateTill=this.form.dateRange[1],this.form.dateFrom&&this.form.dateTill&&(e=(this.form.dateTill-this.form.dateFrom)/1e3/60/60/24,this.form.tourDays=e)},prevStep(){this.form.pasCurrent.is_hotel,this.step--,this.form.consent=null,this.scrollToTop()},nextStep(){if(1===this.step){if(!this.form.pasCurrent)return this.errors=this.translations.errorChoosePass[this.selectedLocale],!1;this.errors=null,this.step++,this.scrollToTop()}else if(2===this.step){if(!this.form.dateTill||!this.form.dateFrom)return this.errors=this.translations.errorChooseDates[this.selectedLocale],!1;if(!this.form.adults)return this.errors=this.translations.errorChooseAdults[this.selectedLocale],!1;if(this.form.tourDays<this.minDays){let e={ru:"Туры менее "+this.minDays+" суток, недоступны",en:"Minimal tour "+this.minDays+" days"};return this.errors=e[this.selectedLocale],!1}if(this.errors=null,(!this.form.hotel||!this.form.room||!this.form.bed)&&1===this.form.pasCurrent.is_hotel&&this.form.adults)return this.errors=this.translations.errorChooseRoom[this.selectedLocale],!1;this.form.adults&&null==this.errors&&(this.step++,this.scrollToTop())}else if(4===this.step){if(!this.form.fname||!this.form.sname)return this.errors=this.translations.errorFillFIO[this.selectedLocale],!1;if(!this.form.email)return this.errors=this.translations.errorFillEmail[this.selectedLocale],!1;if(!this.validEmail(this.form.email))return this.errors=this.translations.errorFillCorrectEmail[this.selectedLocale],!1;if(!this.form.phone)return this.errors=this.translations.errorFillPhone[this.selectedLocale],!1;if(!this.validPhone(this.form.phone))return this.errors=this.translations.errorFillCorrectPhone[this.selectedLocale],!1;if(this.form.adults>=2&&(!this.form.gfname||!this.form.gsname))return this.errors=this.translations.errorFillFIO2[this.selectedLocale],!1;if(this.form.adults>=3&&(!this.form.g3fname||!this.form.g3sname))return this.errors=this.translations.errorFillFIO3[this.selectedLocale],!1;if(this.form.adults>=4&&(!this.form.g4fname||!this.form.g4sname))return this.errors=this.translations.errorFillFIO4[this.selectedLocale],!1;if(this.form.adults>=5&&(!this.form.g5fname||!this.form.g5sname))return this.errors=this.translations.errorFillFIO5[this.selectedLocale],!1;if(this.form.adults>=6&&(!this.form.g6fname||!this.form.g6sname))return this.errors=this.translations.errorFillFIO6[this.selectedLocale],!1;this.saveGuest(),this.errors=null,this.step++,this.scrollToTop()}},showPassDetail(e){let t=this.passes.indexOf(this.passes.find(t=>t.code===e));this.passes[t].back?this.passes[t].back=!1:this.passes[t].back=!0},setPassActive(e){this.activePass=e;let t=this.passes.filter(t=>t.code===e);this.form.passColor=t[0].color,this.form.pasCurrent=t[0],this.getActiveHotels(),this.step++},setHotelActive(e){this.form.hotel=e;let t=this.hotels.filter(t=>t.code===e);this.form.hotelCurrent=t[0],this.getActiveHotelRooms(),this.step++},setRoomActive(e){this.form.room=e;let t=this.hotelRooms.filter(t=>t.id===e);this.form.roomCurrent=t[0],this.form.tourPrice=this.form.roomCurrent.total_price,this.step++},getHotelPhotos(){const e={hotelId:this.form.hotel};axios.get(this.phpPath+"api/hotelimg/"+this.form.hotel,e,{responseType:"text"}).then(e=>{e.data?(this.errors=null,this.hotelGallery=Object.values(e.data),this.gallery=Object.values(e.data)):this.errors="no active passes"}).catch(e=>{this.errors="Error axios.get query.",console.log("error",e)})},cleanCurrentRoom(){2===this.step&&(this.form.roomCurrent=null,this.form.room=null,this.form.hotelBreakfast=null,this.form.hotelBreakfastPrice=null)},getRoomPhotos(){const e={hotelId:this.form.hotel,roomId:this.form.room};axios.get(this.phpPath+"api/roomimg/"+this.form.room,e,{responseType:"text"}).then(e=>{if(this.getActiveRoomBeds(),e.data){this.errors=null;let t=this.hotelRooms.filter(e=>e.id===this.form.room);this.form.roomCurrent=t[0],this.roomGallery=Object.values(e.data),this.gallery=Object.values(e.data)}else this.gallery=[{url:this.domain+"app/images/hotels/take1.width-1200.jpegquality-99.png"}]}).catch(e=>{this.errors="Error axios.get query.",console.log("error",e)})},nextPhoto(){let e=this.gallery,t=this.$refs.hotelImage.getAttribute("image-id"),s=e.length,r=Number(t)+Number(1);r<s?(this.$refs.hotelImage.src=e[r].url,this.$refs.hotelImage.setAttribute("image-id",String(r))):(this.$refs.hotelImage.src=e[0].url,r=0,this.$refs.hotelImage.setAttribute("image-id",String(r)))},previousPhoto(){let e=this.gallery,t=this.$refs.hotelImage.getAttribute("image-id"),s=e.length,r=Number(t)-Number(1);Number(r)<0?(r=s-1,this.$refs.hotelImage.src=e[r].url,this.$refs.hotelImage.setAttribute("image-id",String(r))):(this.$refs.hotelImage.src=e[r].url,this.$refs.hotelImage.setAttribute("image-id",String(r)))},applyPromoCode(){this.errors=null;const e={promocode:this.promocode,tourPass:this.form.pasCurrent.code};axios.post(this.phpPath+"php/checkPCode.php",e,{responseType:"text"}).then(e=>{this.form.passDiscount=e.data}).catch(e=>{this.errors="Такой промокод нам не известен.",console.log("error",e)}),this.errors=null},sendMail(e){this.errors=null;let t=new FormData;t.append("tourNumber",e),axios({method:"post",url:this.phpPath+"app/php/send.php",data:t,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(e=>{console.log("response",e)}).catch(e=>{console.log("error",e)}),this.errors=null},saveVoucher(e,t){if(!this.form.consent)return this.errors="Без согласия на обработку персональных данных мы не сможем принять ваш запрос.",!1;{this.errors=null,this.form.tourNumber=e,this.form.tourID=t;let s=new FormData,r=new Map([[1,this.translations.guestMail[this.selectedLocale]],[2,this.translations.guestsMail[this.selectedLocale]],[3,this.translations.guestsMail[this.selectedLocale]],[4,this.translations.guestsMail[this.selectedLocale]],[5,this.translations.guestssMail[this.selectedLocale]],[6,this.translations.guestssMail[this.selectedLocale]]]),o=this.form.adults+" "+r.get(this.form.adults),a=1!==this.form.kids||2!==this.form.kids?0:this.form.kids,i=Math.round(Number(this.form.tourDays)),l={year:"numeric",month:"long",day:"numeric"};if(s.append("tourNumber",this.form.tourNumber),s.append("tourID",this.form.tourID),s.append("tourName",this.form.tourName),s.append("name",this.form.fname),s.append("lastname",this.form.sname),s.append("email",this.form.email),s.append("phone",this.form.phone),1===this.form.pasCurrent.is_hotel){let e;e=1===this.form.roomCurrent.breakfasts||!0===this.form.hotelBreakfast?this.translations.hotelMailBreakfast[this.selectedLocale]:this.translations.hotelMailNoBreakfast[this.selectedLocale],s.append("room",this.form.room),s.append("bed",this.form.bed),s.append("roomName",this.form.roomCurrent.name),s.append("hotel",this.form.hotel),s.append("hotelName",this.form.hotelCurrent.name),s.append("address",this.form.hotelCurrent.address),s.append("hotelBreakfast",e),this.form.hotelBreakfastText=e,s.append("breakfasts",this.form.hotelBreakfast)}s.append("passname",this.form.pasCurrent.name),s.append("g2fname",this.form.gfname),s.append("g2sname",this.form.gsname),s.append("g3fname",this.form.g3fname),s.append("g3sname",this.form.g3sname),s.append("g4fname",this.form.g4fname),s.append("g4sname",this.form.g4sname),s.append("g5fname",this.form.g5fname),s.append("g5sname",this.form.g5sname),s.append("g6fname",this.form.g6fname),s.append("g6sname",this.form.g6sname),s.append("gphone",this.form.gphone),s.append("gemail",this.form.gemail),s.append("promocode",this.form.promocode),s.append("dateFrom",this.form.dateFrom.toLocaleString("ru",l)),s.append("dateTill",this.form.dateTill.toLocaleString("ru",l)),s.append("adults",o),this.form.adultsText=o,s.append("adultsNum",this.form.adults),s.append("kids",a),this.form.kidsText=a,s.append("hotelPrice",this.form.hotelPrice),s.append("tourPrice",this.form.tourPrice),s.append("skipassPrice",this.form.skipassPrice),s.append("breakfastPrice",this.form.hotelBreakfastPrice),s.append("passDiscount",this.form.passDiscount),s.append("tourDays",String(i)),axios({method:"post",url:this.phpPath+"app/php/saveVoucher.php",data:s,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(e=>{}).catch(e=>{})}},getPassPrice(e){const t={event:"nsc",pass:e};axios.post(this.phpPath+"php/getPassPrice.php",t,{responseType:"text"}).then(e=>{e.data?(this.errors=null,this.freeHotels=Array.from(e.data)):(console.log("response.data"),console.log(e.data),this.errors="Ошибка получения цены.")}).catch(e=>{this.errors="Ошибка запроса информации по ценам.",console.log("error",e)})},getActivePasses(){const e={event:this.form.event};axios.get(this.phpPath+"api/passes",e,{responseType:"text"}).then(e=>{if(e.data)return this.errors=null,this.passes=Object.values(e.data),e.data;this.errors="no active passes"}).catch(e=>{this.errors="Error get query api/passes.",console.log("error",e)})},getActiveHotels(){let e={day:"numeric"},t=parseInt(this.form.dateFrom.toLocaleString("ru",e)),s=parseInt(this.form.dateTill.toLocaleString("ru",e));const r={tourDays:this.days.slice(vm.days.indexOf(t),vm.days.indexOf(s))};axios.get(this.phpPath+"api/hotels",r,{responseType:"text"}).then(e=>{e.data?this.hotels=Object.values(e.data):this.errors="Нет доступных отелей на эти даты."}).catch(e=>{this.errors="Ошибка запроса информации по выбранному отелю.",console.log("error",e)})},getActiveHotelRooms(){this.form.skipassPrice=1500;let e=this.form.dateFrom,t=this.form.dateTill,s=this.form.tourDays;axios.get(this.phpPath+"api/hotelrooms/"+this.form.hotelCurrent.id,{params:{hotelId:this.form.hotelCurrent.id,tourDays:s,adults:this.form.adults,dateStart:e,dateEnd:t,passPrice:this.form.pasCurrent.price,skiPassPrice:this.form.skipassPrice}},{responseType:"text"}).then(e=>{e.data?(this.errors=null,this.hotelRooms=Object.values(e.data)):(this.hotelRooms=[],this.errors="Все номера в этом отеле проданы.")}).catch(e=>{this.errors="Ошибка запроса информации по выбранному номеру в отеле.",console.log("error",e)})},getActiveRoomBeds(){axios.get(this.phpPath+"api/roombeds/"+this.form.room,{},{responseType:"text"}).then(e=>{e.data?(this.errors=null,this.hotelRoomBeds=Object.values(e.data)):this.errors="Ошибка получения размещений."}).catch(e=>{this.errors="Ошибка запроса api/roombeds/.",console.log("error",e)})},saveGuest(){const e={email:this.form.email,phone:this.form.phone,name:this.form.fname,lastname:this.form.sname};axios.post(this.phpPath+"api/guest/",e,{responseType:"text",timeout:1e3},{timeout:1e3}).then(e=>{201===e.data.status?this.errors=null:200===e.data.status&&(this.errors=null,this.form.guest=Object.values(e.data))}).catch(e=>{this.errors="Ошибка запроса api/guest/.",console.log("error",e)})},saveApiVoucher(){this.form.guests=[this.form.gfname+" "+this.form.gsname,this.form.g3fname+" "+this.form.g3sname,this.form.g4fname+" "+this.form.g4sname,this.form.g5fname+" "+this.form.g5sname,this.form.g6fname+" "+this.form.g6sname];const e=this.form;axios.post(this.phpPath+"api/voucher/",e,{responseType:"text",timeout:1e3},{timeout:1e3}).then(e=>{(201===e.data.status||200===e.data.status)&&(this.errors=null)}).catch(e=>{this.errors="Ошибка запроса api/voucher/.",console.log("error",e)})},updateQuota(e){const t={tourNumber:e};axios.post(this.phpPath+"api/quota/",t,{responseType:"text",timeout:1e3},{timeout:1e3}).then(e=>{(201===e.data.status||200===e.data.status)&&(this.errors=null)}).catch(e=>{this.errors="Ошибка запроса api/quota/.",console.log("error",e)})}},created:function(){},beforeMount(){this.getActivePasses()},mounted:function(){let e=this.$route.query;console.log("step 1"+this.step),"5"===e.step&&"0"!==e.par?(this.step=5,this.form.payed=0,console.log("step "+this.step)):"5"===e.step&&"0"===e.par&&(console.log("step 2"+this.step),this.step=5,this.form.payed=1,console.log("step 3"+this.step),this.sendMail(e.tourNumber),this.updateQuota(e.tourNumber))},updated(){},computed:{getDomain(){"localhost"===this.domain?this.phpPath="nscamp/app/":this.phpPath=""},dateFrom(){return 1===this.form.pasCurrent.is_hotel?"дата приезда":"дата действия браслета с"},dateTill(){return 1===this.form.pasCurrent.is_hotel?"дата выезда":"дата действия браслета по"},userFIO(){return this.form.fname+" "+this.form.sname},guestsNum(){let e="",t="";return this.form.kids&&(1===this.form.kids?e=" / "+this.form.kids+" ребенок":this.form.kids>1&&(e=" / "+this.form.kids+" детей")),t=this.form.adults>1?this.form.adults+" взрослых":this.form.adults+" взрослый",t+e},roomName(){return!(1!==this.form.pasCurrent.is_hotel||!this.form.hotel)&&(this.form.roomName=this.form.roomCurrent.name,this.form.roomName)},setTourName(){return 1===this.form.pasCurrent.is_hotel&&this.form.hotel?this.form.tourName="New Star Camp tour, hotel: "+this.form.hotelCurrent.name:this.form.tourName="New Star Camp Festival Pass",this.form.tourName},activeRooms(){return this.hotelRooms.filter(e=>e.maxGuests>=this.form.adults)},activeRoomBeds(){return this.hotelRoomBeds},calcTourPrice(){let e=0,t="",s="",r=0,o=0;1===this.form.pasCurrent.is_hotel&&this.form.hotelCurrent&&this.form.roomCurrent&&(t=this.form.room,s=this.form.hotelCurrent.gain);let a=this.form.tourDays,i=this.form.pasCurrent.price*this.form.adults*this.form.passDiscount;if(this.form.passDiscount<1&&(this.form.promocode=this.promocode),!this.form.roomCurrent||1!==this.form.pasCurrent.is_hotel)return 0===this.form.pasCurrent.is_hotel?(e=i,0===e&&(e=1),this.form.tourPrice=Math.ceil(e),Math.ceil(e)+"₽"):"Ошибка расчета";{let t={day:"numeric"},l=parseInt(this.form.dateFrom.toLocaleString("ru",t)),n=parseInt(this.form.dateTill.toLocaleString("ru",t));arCurRoom=this.form.roomCurrent;let h=0;1===this.form.adults?h=arCurRoom.price_room*a:2===this.form.adults?h=arCurRoom.price_room2*a:3===this.form.adults?h=arCurRoom.price_room3*a:4===this.form.adults?h=arCurRoom.price_room4*a:5===this.form.adults?h=arCurRoom.price_room5*a:6===this.form.adults&&(h=arCurRoom.price_room6*a),this.form.hotelBreakfast&&(1===this.form.adults?o=arCurRoom.price_breakfasts*a:2===this.form.adults?o=arCurRoom.price_breakfasts2*a:3===this.form.adults?o=arCurRoom.price_breakfasts3*a:4===this.form.adults?o=arCurRoom.price_breakfasts4*a:5===this.form.adults?o=arCurRoom.price_breakfasts5*a:6===this.form.adults&&(o=arCurRoom.price_breakfasts6*a)),r=h;let u=0;if(this.form.adults>0&&a>=this.minDays)return e=u+i+(r+o)*s,"https://nswpay.ru/"!==window.location.href&&(console.log("Start -- adults "+this.form.adults),console.log("daysTour "+a),console.log("hotelTotalPrice dayStart indexOf "+vm.days.indexOf(l)),console.log("hotelTotalPrice dayStart "+l),console.log("hotelTotalPrice dayEnd indexOf "+vm.days.indexOf(n)),console.log("hotelTotalPrice dayEnd "+n),console.log("passPrice no discount "+this.form.pasCurrent.price*this.form.adults),console.log("passPrice "+i),console.log("skipassPrice "+u),console.log("discount "+this.form.passDiscount),console.log("hotelTotalPrice "+r),console.log("allBreakfasts "+o),console.log("gain "+s),console.log("hotelTotalPrice + breafast * gain "+(r+o)*s)),this.form.hotelPrice=r,this.form.skipassPrice=0*(a-1)*this.form.adults,this.form.hotelBreakfastPrice=o,this.form.tourPrice=Math.ceil(e),Math.ceil(e)+"₽"}}},watch:{},destroyed(){}});