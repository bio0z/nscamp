Vue.component("modal",{template:"#modal-template"}),Vue.filter("toCurrency",(function(e){return"number"!=typeof e?e:new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB",minimumFractionDigits:0}).format(e)})),Vue.directive("phone",{bind(e){e.oninput=function(t){if(!t.isTrusted)return;let s=this.value.replace(/\D/g,"").match(/(\d{0,1})(\d{0,3})(\d{0,3})(\d{0,2})(\d{0,2})/);this.value=s[1]+" ("+s[2]+") "+s[3]+" "+s[4]+" "+s[5],e.dispatchEvent(new Event("input"))}}});const router=new VueRouter({routes:[],mode:"history"});function isValidDate(e){return e instanceof Date&&!isNaN(e)}Vue.config.devtools=!1;let vm=new Vue({router:router,el:"#orderForm",components:{},data:{domain:document.domain,locales:{ru:"RU",en:"EN"},selectedLocale:"ru",days:[1,2,3,4],minDays:3,firstDay:new Date(2023,9,21),dateClearable:!1,innerValue:[new Date("2023-09-21"),new Date("2023-09-24")],activePass:null,passDetails:null,gallery:null,hotelGallery:null,roomGallery:null,currentStep:null,form:{event:"NSW23",currentEvent:null,passColor:"#777fa8",passColorVoucher:null,pasCurrent:null,passCurrentPrice:0,dateRange:[new Date("2023-09-21"),new Date("2023-09-24")],dateFrom:"2023-09-21",dateTill:"2023-09-24",tourDays:3,skiPassDays:0,adults:1,adultsText:null,kids:null,kidsText:null,hotel:null,hotelCurrent:null,hotelBreakfast:0,hotelBreakfastText:null,hotelBreakfastPrice:null,hotelPrice:null,address:null,room:null,roomCurrent:null,bed:null,bedId:null,fname:null,sname:null,email:null,phone:null,guest:null,guests:null,gfname:null,gsname:null,gphone:null,gemail:null,g3sname:null,g3fname:null,g3phone:null,g3email:null,g4fname:null,g4sname:null,g4phone:null,g4email:null,g5fname:null,g5sname:null,g5phone:null,g5email:null,g6sname:null,g6fname:null,g6phone:null,g6email:null,promocode:null,consent:null,offer:null,tourName:null,tourNumber:null,tourID:null,skiPassPrice:1500,tourPrice:0,hotelTotal:0,passTotal:0,skiPassTotal:0,hotelBreakfastTotal:0,arrTourDays:null,payed:null,passDiscount:0,passDiscountPercent:0},translations:{title:{ru:"Купить билет",en:"Festival Pass"},titleP:{ru:"Купить билет",en:"Festival Pass"},stepTour:{ru:"Выберите тип посещения фестваля",en:"Choose your tour"},festPass:{ru:"<p>Браслет участника дает право доступа на мероприятия фестиваля, но не включает в себя проживание, merch pack и скипасc.</p>",en:"<p>Браслет участника дает право доступа на мероприятия фестиваля, но не включает в себя проживание, merch pack и скипасс.</p>"},bannerVisaTitle:{ru:"Выиграй сноуборд с VISA!",en:"Выиграй сноуборд с VISA!"},bannerVisaText:{ru:'С 7 декабря по 7 марта оплати тур на New Star Weekend картой VISA и стань участником розыгрыша трех сноубордов! <br> Подробности на <a href="http://newstarcamp.ru">newstarcamp.ru</a>',en:'С 7 декабря по 7 марта оплати тур на New Star Weekend картой VISA и стань участником розыгрыша трех сноубордов! <br> Подробности на <a href="http://newstarcamp.ru">newstarcamp.ru</a>'},bracelet:{ru:"Браслет участника",en:"Festival pass"},skipass:{ru:"Скипасс",en:"Ski pass"},skipassDays:{ru:"дней",en:"days"},tourNights:{ru:"ночи",en:"nights"},tourSum:{ru:"стоимость тура:",en:""},tourSumFrom:{ru:"От",en:"From"},chooseButton:{ru:"Выбрать",en:"Book now"},step1:{ru:"Выберите тур",en:"Choose your tour"},guest1:{ru:"1 гость",en:"1 guest"},guest2:{ru:"2 гостя",en:"2 guests"},guest3:{ru:"3 гостя",en:"3 guests"},guest4:{ru:"4 гостя",en:"4 guests"},guest5:{ru:"5 гостей",en:"5 guests"},guest6:{ru:"6 гостей",en:"6 guests"},guest7:{ru:"7 гостей",en:"7 guests"},guest8:{ru:"8 гостей",en:"8 guests"},guest9:{ru:"9 гостей",en:"9 guests"},guest10:{ru:"10 гостей",en:"10 guests"},guest11:{ru:"11 гостей",en:"11 guests"},guest12:{ru:"12 гостей",en:"12 guests"},guest13:{ru:"13 гостей",en:"13 guests"},guest14:{ru:"14 гостей",en:"14 guests"},guest15:{ru:"15 гостей",en:"15 guests"},guest1fp:{ru:"1 браслет",en:"1 guest"},guest2fp:{ru:"2 браслета",en:"2 guest"},guest3fp:{ru:"3 браслета",en:"3 guest"},guest4fp:{ru:"4 браслета",en:"4 guest"},guest5fp:{ru:"5 браслетов",en:"5 guest"},guest6fp:{ru:"6 браслетов",en:"6 guest"},breakfastIncluded:{ru:"Завтрак включен в стоимость",en:"breakfast included"},roomType:{ru:"Тип номера",en:"Type of room"},roomNumber:{ru:"Номер",en:"Type of room"},bedType:{ru:"Тип кровати",en:"Type of bed"},hotelType:{ru:"Отель",en:"Hotel"},hotelBreakfast:{ru:"Завтраки",en:"Breakfast"},hotelBreakfastIncluded:{ru:"Завтрак включен",en:"Breakfast included"},hotelBreakfastNotIncluded:{ru:"Проживание без завтрака",en:"Breakfast not included"},passDetails:{ru:"Подробнее",en:"More"},soldOut:{ru:"Sold Out",en:"Sold Out"},stepNext:{ru:"Далее",en:"Next"},tourPriceText:{ru:"cтоимость тура ",en:"tour сost "},stepPrevious:{ru:"Назад",en:"Back"},guestPersonalData:{ru:"Ваши данные:",en:"Guest personal data:"},firstGuest:{ru:"Первый гость",en:"First guest"},secondGuest:{ru:"Второй гость",en:"Second guest"},thirdGuest:{ru:"Третий гость",en:"Third guest"},fourthGuest:{ru:"Четвертый гость",en:"Fourth guest"},fifthGuest:{ru:"Пятый гость",en:"Fourth guest"},sixGuest:{ru:"Шестой гость",en:"Six guest"},guestName:{ru:"Имя",en:"Name"},guestsName:{ru:"Браслеты",en:"Bracelet"},guestsMail:{ru:"гостя",en:"guests"},guestMail:{ru:"гость",en:"guest"},guestssMail:{ru:"гостей",en:"guest"},hotelMailBreakfast:{ru:"с завтраком",en:"with breakfast"},hotelMailNoBreakfast:{ru:"без завтрака",en:"no breakfast"},guestSurname:{ru:"Фамилия",en:"Surname"},guestPhone:{ru:"Телефон",en:"Phone num"},guestHotel:{ru:"Отель",en:"Hotel"},guestPromoCode:{ru:"Промокод",en:"Promocode"},guestPromoCodeApply:{ru:"Применить",en:"Apply"},guestPromoCodeDiscount:{ru:"Скидка использована",en:"Promocode used"},userAgreement:{ru:"Договор оферты",en:"user agreement"},newStarFAQ:{ru:"Часто задаваемые вопросы и ответы",en:"FAQ"},dateFrom:{ru:"Дата заезда",en:"Date in"},dateTill:{ru:"Дата выезда",en:"Date out"},dateNote:{ru:"* Туры длительностью менее 9 дней станут доступны с 01.01.2021",en:"* Туры длительностью менее 9 дней станут доступны с 01.01.2021"},tourAdults:{ru:"Количество взрослых",en:"Number of adults"},tourKids:{ru:"Количество детей",en:"Number of children"},errorChoosePass:{ru:"Вы забыли выбрать категорию",en:"Please, choose your pass"},errorChooseDates:{ru:"Вы забыли выбрать даты заезда",en:"Please, choose your the dates of tour"},errorChooseAdults:{ru:"Вы забыли выбрать количество человек",en:"Please, choose number of people"},errorChooseRoom:{ru:"Вы забыли выбрать вариант размещения",en:"Please, choose your accommodation."},errorFillFIO:{ru:"Вы забыли заполнить персональные данные",en:"Please, fill Name and Surname."},errorFillFIO2:{ru:"Вы забыли заполнить персональные данные второго гостя",en:"Please, fill Name and Surname."},errorFillFIO3:{ru:"Вы забыли заполнить персональные данные третьего гостя",en:"Please, fill Name and Surname."},errorFillFIO4:{ru:"Вы забыли заполнить персональные данные четвертого гостя",en:"Please, fill Name and Surname."},errorFillFIO5:{ru:"Вы забыли заполнить персональные данные пятого гостя",en:"Please, fill Name and Surname."},errorFillFIO6:{ru:"Вы забыли заполнить персональные данные шестого гостя",en:"Please, fill Name and Surname."},errorFillEmail:{ru:"Укажите электронную почту",en:"Please, fill Email"},errorFillCorrectEmail:{ru:"Укажите корректный адрес электронной почты",en:"Please, fill correct Email"},errorFillPhone:{ru:"Укажите Телефон",en:"Please, fill number of cell phone"},errorFillCorrectPhone:{ru:"Укажите корректный телефон",en:"Please, fill correct number of cell phone"},tourIncludedHeader:{ru:"В пакетное предложение включено:",en:"Tour included:"},tourIncludedHotel:{ru:"Проживание в отеле",en:"Hotel accommodation"},tourUsePromo:{ru:"Введите промокод, если имеется",en:"Insert your promo code if you have one"},tourIncludedP:{ru:"<p><b>В тур включено:</b></p></li><ul></li><li> Браслет участника</li></li></ul>",en:"<p><b>Tour details:</b></p></li><ul></li><li> Festival PASS</li></li></ul>"},tourIncluded:{ru:"<p><b>В тур включено:</b></p></li><ul></li><li> Браслет участника</li></li><li> Проживание в отеле</li></li></ul>",en:"<p><b>Tour details:</b></p></li><ul></li><li> Festival PASS</li></li><li> Hotel accommodation</li></li><li> Cable lifts ticket(s)</li></li></ul>"},guestAgreement:{ru:"Я даю ",en:"I accept "},guestAgreement1:{ru:"Договором оферты ",en:"Terms and Conditions"},guestAgreement2:{ru:"на обработку персональных данных",en:"."},guestOfferAccept:{ru:"Я согласен c ",en:"I accept "},guestOfferAccept1:{ru:"политикой конфиденциальности",en:"offer."},buyTour:{ru:"Купить",en:"Buy"},tourTanks:{ru:"Спасибо",en:"Thank you"},tourSuccess:{ru:"<p>Благодарим вас за покупку тура на Quiksilver New Star Weekend 2023</p>\n<p>Тур и ваучеры на получение ски-пасса <br>отправлены на указанную вами почту.</p>",en:"<p>Thank you for your purchase!</p><p>The tour voucher has been sent to your e-mail.</p><p>Please expect the ski pass voucher closer to festival dates.</p>"},tourFail:{ru:'<p>Возникла ошибка при проведении платежа</p><a href="#">попробуйте еще раз</a>.</p>',en:'<p>An error occurred while making a payment, </p><a href="#">try again</a>.</p>'},newStarDesc:{ru:"ООО «Нью Стар» — организатор спортивно-музыкального фестиваля New Star Weekend,который пройдёт 21 - 25 сентября 2023 года на всесезонном горном курорте «Роза Хутор» (Сочи)",en:"“New Star” LLC is the organizer of “New Star Weekend” sports and music festival, that will be held on March 21 - 25 September, 2023 at Russian ski resort “Rosa Khutor” (Sochi)."},tourDates2124:{ru:"21 - 24 cентября",en:"21 - 24 september"}},sent:!1,showModal:!1,showOffer:!1,step:1,totalsteps:5,errors:null,guests:1,error:null,steps:[{active:!0,id:1,name:{ru:"Выберите<br> билет",en:"Tour<br> category"},text:"text-left",col:"col",desc:{ru:"<p>До путешествия на NEW STAR WEEKEND осталось всего несколько шагов. Здесь ты можешь подобрать подходящую категорию билета на все дни фестиваля. <br>Выбери один из вариантов, чтобы начать:</p>",en:"<p>There are a few steps left before traveling to Quiksilver New Star Weekend 2023. Here you can choose a tour and find out what exactly is included in it. Choose one of the options to get started.</p>"}},{active:!1,id:2,name:{ru:"Выберите<br> отель",en:"Hotel"},text:"text-center",col:"col-3",desc:{ru:'Любой из отелей курорта "Роза Хутор" гарантирует удобную логистику до площадок фестиваля и сэкономит твое время, чтобы ты все успел.',en:'Любой из отелей курорта "Роза Хутор" гарантирует удобную логистику до площадок фестиваля и сэкономит твое время, чтобы ты все успел.'}},{active:!1,id:3,name:{ru:"Выбор<br> номера",en:"Accomodation"},text:"text-center",col:"col-3",desc:"Во всех отелях курорта есть номера на любой вкус и кошелек. Просто выбери подходящий номер.<br> Рекомендуем добавить завтрак, чтобы начать день в горах полным энергии!"},{active:!1,id:4,name:{ru:"Давайте <br>знакомиться",en:"Давайте <br>знакомиться"},text:"text-center",col:"col-3",desc:{ru:"Пожалуйста, укажите ваши данные для оформления покупки и получения ваучера:",en:"Пожалуйста, укажите ваши данные для оформления покупки и получения ваучера:"}},{active:!1,id:4,name:{ru:"Дабл-чек",en:"Дабл-чек"},text:"text-center",col:"col-3",desc:{ru:"Проверьте введенные данные, подтвердите согласие на их обработку и согласие с Договором оферты и нажмите кнопку «Купить»",en:"Проверьте введенные данные, подтвердите согласие на их обработку и согласие с Договором оферты и нажмите кнопку «Купить»"}}],passSDetails:!1,passVDetails:!1,passPDetails:!1,passes:null,hotelQuota:"",freeHotels:[],hotelRooms:null,hotelRoomBeds:null,hotels:[]},methods:{goToNSCsite(){window.open("https://newstarcamp.ru/news/visa_snowboards/?utm_source=nswpay&utm_medium=banner&utm_campaign=visa")},acceptNumber(){let e=this.form.phone.replace(/\D/g,"").match(/(\d{0,1})(\d{0,3})(\d{0,3})(\d{0,4})/);this.form.phone=e[1]+" ("+e[2]+") "+e[3]+" "+e[4]},activePasses(){if(this.passes)return this.passes.filter(e=>1===e.active)},activeHotels(){if(this.passes&&this.form.adults&&this.form.dateFrom&&this.form.dateTill)return this.hotels.filter(e=>e.maxGuests>=this.form.adults)},getClasses:(e,t,s)=>!/disabled|active|not-current-month/.test(s)&&2===t.length&&e.getTime()>t[0].getTime()&&e.getTime()<t[1].getTime()?"in-range":"",handleSelect(e){const[t,s]=this.innerValue;isValidDate(t)&&!isValidDate(s)?(t.getTime()>e.getTime()?this.innerValue=[e,t]:this.innerValue=[t,e],this.form.dateRange=this.innerValue):this.innerValue=[e,new Date(NaN)]},setLocale:function(e){this.selectedLocale=e},validEmail:function(e){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)},validPhone:function(e){return!0},scrollToTop(){let e=document.getElementById("orderForm");window.scrollTo(0,e.offsetTop)},calcTourDays(){2124==this.form.dateRange&&(this.form.dateFrom="2023-09-21",this.form.dateTill="2023-09-24",this.form.tourDays=3,this.form.skiPassDays=3,this.translations.skipassDays={ru:"дня",en:"days"},this.translations.tourNights={ru:"ночи",en:"nights"}),this.form.dateFrom&&this.form.dateTill&&1===this.form.pasCurrent.is_hotel&&this.getActiveHotels()},cleanCurrentForm(){this.hotels=[],this.form.hotelCurrent=[],this.form.roomCurrent=[],this.form.hotelBreakfast=0},prevStep(){4===this.step&&0===this.form.pasCurrent.is_hotel&&(this.step=2,this.scrollToTop()),this.step--,this.form.consent=null,this.scrollToTop()},nextStep(){if(1===this.step){if(!this.form.pasCurrent)return this.errors=this.translations.errorChoosePass[this.selectedLocale],!1;this.errors=null,this.step++,this.scrollToTop()}else if(2===this.step){if(!this.form.dateTill||!this.form.dateFrom)return this.errors=this.translations.errorChooseDates[this.selectedLocale],!1;if(!this.form.adults)return this.errors=this.translations.errorChooseAdults[this.selectedLocale],!1;if(this.form.tourDays<this.minDays){let e={ru:"Туры менее "+this.minDays+" дней, недоступны",en:"Minimal tour "+this.minDays+" days"};return this.errors=e[this.selectedLocale],!1}this.errors=null,this.form.adults&&null==this.errors&&(0===this.form.pasCurrent.is_hotel?(this.step=this.step+2,this.scrollToTop()):(this.step++,this.scrollToTop()))}else if(4===this.step){if(console.log("this.step 4 "+this.step),!this.form.fname||!this.form.sname)return this.errors=this.translations.errorFillFIO[this.selectedLocale],!1;if(!this.form.email)return this.errors=this.translations.errorFillEmail[this.selectedLocale],!1;if(!this.validEmail(this.form.email))return this.errors=this.translations.errorFillCorrectEmail[this.selectedLocale],!1;if(!this.form.phone)return this.errors=this.translations.errorFillPhone[this.selectedLocale],!1;if(!this.validPhone(this.form.phone))return this.errors=this.translations.errorFillCorrectPhone[this.selectedLocale],!1;if(1===this.form.pasCurrent.is_hotel){if(this.form.adults>=2&&(!this.form.gfname||!this.form.gsname))return this.errors=this.translations.errorFillFIO2[this.selectedLocale],!1;if(this.form.adults>=3&&(!this.form.g3fname||!this.form.g3sname))return this.errors=this.translations.errorFillFIO3[this.selectedLocale],!1;if(this.form.adults>=4&&(!this.form.g4fname||!this.form.g4sname))return this.errors=this.translations.errorFillFIO4[this.selectedLocale],!1;if(this.form.adults>=5&&(!this.form.g5fname||!this.form.g5sname))return this.errors=this.translations.errorFillFIO5[this.selectedLocale],!1;if(this.form.adults>=6&&(!this.form.g6fname||!this.form.g6sname))return this.errors=this.translations.errorFillFIO6[this.selectedLocale],!1;this.saveGuest(),this.calcTourPrice(),this.setTourName(),this.errors=null,this.step++,this.scrollToTop()}else this.saveGuest(),this.calcTourPrice(),this.setTourName(),this.errors=null,this.step++,this.scrollToTop()}},setPassActive(e){this.activePass=e;let t=this.passes.filter(t=>t.code===e);1===t[0].is_hotel?(this.form.skiPassPrice=this.form.currentEvent.skipass_price,this.form.passColor=t[0].color,this.form.passColorVoucher=t[0].voucher_color,this.form.passCurrentPrice=t[0].price,this.form.pasCurrent=t[0],this.getActiveHotels(),this.step++,this.scrollToTop(),this.discountClear()):0===t[0].is_hotel&&(this.form.skiPassPrice=0,this.form.passCurrentPrice=t[0].price,this.form.pasCurrent=t[0],this.form.passColorVoucher=t[0].voucher_color,this.hotels=[],this.step++,this.scrollToTop(),this.discountClear())},setHotelActive(e){let t=[21].includes(new Date(this.form.dateFrom).getDate()),s=[24].includes(new Date(this.form.dateTill).getDate());if(this.form.tourDays<this.minDays){let e={ru:"Туры менее "+this.minDays+" дней недоступны",en:"Minimal tour "+this.minDays+" days"};return this.errors=e[this.selectedLocale],!1}if(!0!==s||!0!==t){let e={ru:"Короткие туры должны начинаться 1, 2 или 6 и заканчиваться 6, 9 или 10 апреля",en:"Короткие туры должны начинаться 1, 2 или 6 и заканчиваться 6, 9 или 10 апреля"};return this.errors=e[this.selectedLocale],!1}{this.form.hotel=e;let t=this.hotels.filter(t=>t.id===e);this.form.hotelCurrent=t[0],this.getActiveHotelRooms(),this.step++,this.scrollToTop()}},setRoomActive(e){this.form.room=e;let t=this.hotelRooms.filter(t=>t.id===e);this.form.roomCurrent=t[0],this.form.hotelBreakfastTotal=t[0].total_breakfasts,this.form.skiPassTotal=t[0].total_skiPass,this.form.hotelTotal=t[0].total_hotel,this.form.passTotal=t[0].total_pass,this.form.tourPrice=1===this.form.hotelBreakfast?this.form.roomCurrent.total_price+this.form.roomCurrent.total_breakfasts:this.form.roomCurrent.total_price,this.step++,this.scrollToTop()},getHotelPhotos(){const e={hotelId:this.form.hotel};axios.get("api/hotelimg/"+this.form.hotel,e,{responseType:"text"}).then(e=>{e.data?(this.errors=null,this.hotelGallery=Object.values(e.data),this.gallery=Object.values(e.data)):this.errors="no active passes"}).catch(e=>{this.errors="Error axios.get query.",console.log("error",e)})},getRoomPhotos(){const e={hotelId:this.form.hotel,roomId:this.form.room};axios.get("api/roomimg/"+this.form.room,e,{responseType:"text"}).then(e=>{if(this.getActiveRoomBeds(),e.data){this.errors=null;let t=this.hotelRooms.filter(e=>e.id===this.form.room);this.form.roomCurrent=t[0],this.roomGallery=Object.values(e.data),this.gallery=Object.values(e.data)}else this.gallery=[{url:this.domain+"nsw23/images/hotels/take1.width-1200.jpegquality-99.png"}]}).catch(e=>{this.errors="Error axios.get query.",console.log("error",e)})},getEvent(e,t){axios.get("api/curevent",{params:{code:this.form.event}},{responseType:"text"}).then(e=>{this.form.currentEvent=e.data[0]}).catch(e=>{this.errors="Ошибка запроса api/event/.",console.log("error",e)})},applyPromoCode(){this.errors=null;const e={promoCode:this.form.promocode,eventCode:this.form.event,tourPass:this.form.pasCurrent.code,tourPassId:this.form.pasCurrent.id};axios.post("api/promo",e,{responseType:"json"}).then(e=>{!1!==e.data&&(void 0!==e.data.percent&&void 0!==e.data.discount?this.form.passDiscount!==Number(e.data.discount)?(this.form.passDiscount=Number(e.data.discount),this.form.passDiscountPercent=Number(e.data.percent),this.calcTourPrice()):this.form.passDiscountPercent!==Number(e.data.percent)?(this.form.passDiscountPercent=Number(e.data.percent),this.form.passDiscount=Number(e.data.discount),this.calcTourPrice()):this.errors="Купон применен, скидка не изменилась!":this.errors="Промокод не корректный")}).catch(e=>{this.errors="Такой промокод нам не известен.",console.log("error",e)}),this.errors=null},sendMail(e){this.errors=null;let t=new FormData;t.append("tourNumber",e),axios({method:"post",url:"nsw23/php/send.php",data:t,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(e=>{console.log("response",e)}).catch(e=>{console.log("error",e)}),this.errors=null},saveApiVoucher(){let e={year:"numeric",month:"numeric",day:"numeric"};this.form.dateFrom=this.form.dateFrom.toLocaleString("ru",e),this.form.dateTill=this.form.dateTill.toLocaleString("ru",e);const t=this.form;axios.post("api/voucher/",t,{responseType:"text",timeout:1e3},{timeout:1e3}).then(e=>{(201===e.data.status||200===e.data.status)&&(this.errors=null)}).catch(e=>{this.errors="Ошибка запроса api/voucher/.",console.log("error",e)})},saveVoucher(e,t){if(!this.form.consent)return this.errors="Без согласия на обработку персональных данных мы не сможем принять ваш запрос.",!1;{this.errors=null,this.form.tourNumber=e,this.form.tourID=t;let s=new FormData,r=new Map([[1,this.translations.guestMail[this.selectedLocale]],[2,this.translations.guestsMail[this.selectedLocale]],[3,this.translations.guestsMail[this.selectedLocale]],[4,this.translations.guestsMail[this.selectedLocale]],[5,this.translations.guestssMail[this.selectedLocale]],[6,this.translations.guestssMail[this.selectedLocale]]]),o=this.form.adults+" "+r.get(this.form.adults),a=1!==this.form.kids||2!==this.form.kids?0:this.form.kids,i=Math.round(Number(this.form.tourDays)),l={year:"numeric",month:"numeric",day:"numeric"};if(s.append("tourNumber",this.form.tourNumber),s.append("tourID",this.form.tourID),s.append("tourName",this.form.tourName),s.append("name",this.form.fname),s.append("lastname",this.form.sname),s.append("email",this.form.email),s.append("phone",this.form.phone),1===this.form.pasCurrent.is_hotel){let e;e=1===this.form.roomCurrent.breakfasts||1===this.form.hotelBreakfast?this.translations.hotelMailBreakfast[this.selectedLocale]:this.translations.hotelMailNoBreakfast[this.selectedLocale],s.append("room",this.form.room),s.append("bed",this.form.bed),s.append("roomName",this.form.roomCurrent.name),s.append("hotel",this.form.hotelCurrent.id),s.append("hotelName",this.form.hotelCurrent.name),s.append("address",this.form.hotelCurrent.address),s.append("hotelBreakfast",e),this.form.hotelBreakfastText=e,s.append("breakfasts",this.form.hotelBreakfast)}s.append("passname",this.form.pasCurrent.name),s.append("passcode",this.form.pasCurrent.code),s.append("passColor",this.form.passColor),s.append("passColorVoucher",this.form.passColorVoucher),s.append("g2fname",this.form.gfname),s.append("g2sname",this.form.gsname),s.append("g3fname",this.form.g3fname),s.append("g3sname",this.form.g3sname),s.append("g4fname",this.form.g4fname),s.append("g4sname",this.form.g4sname),s.append("g5fname",this.form.g5fname),s.append("g5sname",this.form.g5sname),s.append("g6fname",this.form.g6fname),s.append("g6sname",this.form.g6sname),s.append("gphone",this.form.gphone),s.append("gemail",this.form.gemail),s.append("promocode",this.form.promocode),s.append("dateFrom",this.form.dateFrom.toLocaleString("ru",l)),s.append("dateTill",this.form.dateTill.toLocaleString("ru",l)),s.append("adults",o),s.append("adults_num",this.form.adults),this.form.adultsText=o,s.append("adultsNum",this.form.adults),s.append("kids",a),this.form.kidsText=a,s.append("hotelPrice",this.form.hotelTotal),s.append("tourPrice",this.form.tourPrice),s.append("skiPassPrice",this.form.skiPassTotal),s.append("breakfastPrice",this.form.hotelBreakfastTotal),s.append("passTotal",this.form.passTotal),s.append("passDiscount",this.form.passDiscount),s.append("tourDays",String(i)),s.append("skiPassDays",this.form.skiPassDays),s.append("event",this.form.event),axios({method:"post",url:"nsw23/php/saveVoucher.php",data:s,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(e=>{}).catch(e=>{})}},getActivePasses(e,t){axios.get("api/passes",{params:{event:this.form.event}},{responseType:"text"}).then(e=>{if(e.data)return this.errors=null,this.passes=Object.values(e.data),e.data;this.errors="no active passes"}).catch(e=>{this.errors="Error get query api/passes.",console.log("error",e)})},getActiveHotels(){if(this.form.dateTill&&1===this.form.pasCurrent.is_hotel){let e=this.form.dateFrom,t=this.form.dateTill,s=this.form.tourDays;this.cleanCurrentForm();const r={responseType:"text"};axios.get("api/hotels",{params:{tourDays:s,adults:this.form.adults,dateStart:e,dateEnd:t,passPrice:this.form.passCurrentPrice,skiPassPrice:this.form.skiPassPrice}},r).then(e=>{e.data?this.hotels=Object.values(e.data):this.errors="Нет доступных отелей на эти даты."}).catch(e=>{console.log("error",e)})}},getActiveHotelRooms(){let e=this.form.dateFrom,t=this.form.dateTill,s=this.form.tourDays;axios.get("api/hotelrooms/"+this.form.hotelCurrent.id,{params:{hotelId:this.form.hotelCurrent.id,tourDays:s,adults:this.form.adults,dateStart:e,dateEnd:t,passPrice:this.form.passCurrentPrice,skiPassPrice:this.form.skiPassPrice}},{responseType:"text"}).then(e=>{e.data?(this.errors=null,this.hotelRooms=Object.values(e.data)):(this.hotelRooms=[],this.errors="Все номера в этом отеле проданы.")}).catch(e=>{this.errors="Ошибка запроса информации по выбранному номеру в отеле.",console.log("error",e)})},setBreakfast(e,t){this.hotelRooms[e].breakfast=t,this.form.hotelBreakfast=t,this.hotelRooms[e].breakfastChoosen=1},setRoomBed(e,t){this.form.bed=t,this.hotelRooms[e].bedChoosen=t,1===this.hotelRooms[e].breakfasts?(this.hotelRooms[e].breakfastChoosen=1,this.form.hotelBreakfast=1):1===this.hotelRooms[e].breakfasts_no&&(this.hotelRooms[e].breakfastChoosen=1,this.form.hotelBreakfast=0),this.hotelRooms.forEach((function(t,s,r){s!==e&&(t.bedChoosen=null)}))},getActiveRoomBeds(){axios.get("api/roombeds/"+this.form.room,{},{responseType:"text"}).then(e=>{e.data?(this.errors=null,this.hotelRoomBeds=Object.values(e.data)):this.errors="Ошибка получения размещений."}).catch(e=>{this.errors="Ошибка запроса api/roombeds/.",console.log("error",e)})},saveGuest(){const e={email:this.form.email,phone:this.form.phone,name:this.form.fname,lastname:this.form.sname};axios.post("api/guest/",e,{responseType:"text",timeout:1e3},{timeout:1e3}).then(e=>{201===e.data.status?this.errors=null:200===e.data.status&&(this.errors=null,this.form.guest=Object.values(e.data))}).catch(e=>{this.errors="Ошибка запроса api/guest/.",console.log("error",e)})},updateQuota(e){const t={tourNumber:e};axios.post("api/quota/",t,{responseType:"text",timeout:1e3},{timeout:1e3}).then(e=>{(201===e.data.status||200===e.data.status)&&(this.errors=null)}).catch(e=>{this.errors="Ошибка запроса api/quota/.",console.log("error",e)})},selectToggle(){document.getElementById("customSelect").classList.add("is-active")},chooseGuests(e){this.form.adults=e,document.getElementById("customSelect").classList.remove("is-active");let t=document.getElementById("customSelectSpan");t.innerText="";let s="";s=1===e?0===this.form.pasCurrent.is_hotel?"билет":"гость":0===this.form.pasCurrent.is_hotel?"билета":"гостя",t.innerText=e+" "+s,this.calcTourDays()},discountClear(){this.form.passDiscount=null},calcTourPrice(){if(0===this.form.pasCurrent.is_hotel){let e=this.form.adults<4||null==this.form.pasCurrent.price_many?this.form.pasCurrent.price:this.form.pasCurrent.price_many;return this.form.tourPrice=e*this.form.adults,0===this.form.passDiscountPercent?(this.form.tourPrice=this.form.tourPrice-this.form.passDiscount,this.form.tourPrice):(this.form.tourPrice=this.form.tourPrice-this.form.passDiscount/100*this.form.tourPrice,this.form.tourPrice)}if(1===this.form.pasCurrent.is_hotel)return 0===this.form.passDiscountPercent?(this.form.tourPrice=this.form.tourPrice-this.form.passDiscount,this.form.tourPrice):(this.form.tourPrice=this.form.tourPrice-this.form.passDiscount/100*this.form.tourPrice,this.form.tourPrice)},setTourName(){return 1===this.form.pasCurrent.is_hotel&&this.form.hotel?this.form.tourName="New Star Weekend tour, hotel: "+this.form.hotelCurrent.name:this.form.tourName="New Star Weekend Festival Pass",this.form.tourName}},created:function(){},beforeMount(){this.getActivePasses(),this.getEvent()},mounted:function(){let e=this.$route.query;"6"===e.step&&"0"!==e.par?(this.step=6,this.form.payed=0):"6"===e.step&&"0"===e.par&&(this.step=6,this.form.payed=1)},updated(){},computed:{dateFrom(){return 1===this.form.pasCurrent.is_hotel?"дата приезда":"дата действия браслета с"},dateTill(){return 1===this.form.pasCurrent.is_hotel?"дата выезда":"дата действия браслета по"},userFIO(){return this.form.fname+" "+this.form.sname},guestsNum(){let e="",t="";return this.form.kids&&(1===this.form.kids?e=" / "+this.form.kids+" ребенок":this.form.kids>1&&(e=" / "+this.form.kids+" детей")),t=(this.form.adults,this.form.adults),t+e},activeRooms(){return this.hotelRooms.filter(e=>e.maxGuests>=this.form.adults)},activeRoomBeds(){return this.hotelRoomBeds}},watch:{},destroyed(){}}).$mount("#orderForm");